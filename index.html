<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>植物分類ゲーム</title>
  <style>
    body {
      text-align: center;
      margin: 40px;
      font-family: sans-serif;
    }
    #plantImage {
      max-width: 300px;
      display: block;
      margin: 20px auto;
    }
    #resultCharacter {
      max-width: 300px;
      display: none; /* 最初は非表示 */
      margin: 20px auto;
    }
    #timer {
      font-size: 2em;
      margin: 10px;
    }
    .category-button {
      margin: 5px;
      padding: 10px;
      font-size: 1em;
      cursor: pointer;
    }
    #continueButton {
      position: fixed;
      bottom: -60px; /* 初期位置（画面下の外） */
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 1em;
      display: none; /* 最初は非表示 */
      background-color: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 5px;
      transition: bottom 1s;
      cursor: pointer;
    }
    #finalResult {
      display: none;
      font-size: 1.5em;
      margin-top: 20px;
      color: red;
    }
  </style>
</head>
<body>

<h1>植物分類ゲーム</h1>

<!-- 出題画像 -->
<img id="plantImage" src="" alt="植物の画像">

<!-- 結果発表キャラ -->
<img id="resultCharacter" src="結果発表キャラ.png" alt="結果発表キャラクター">

<!-- タイマー表示 -->
<div id="timer">60</div>

<!-- 分類ボタン（例） -->
<div id="categoryButtons">
  <button class="category-button" data-category="アブラナ科">アブラナ科</button>
  <button class="category-button" data-category="イネ科">イネ科</button>
  <button class="category-button" data-category="ウリ科">ウリ科</button>
  <button class="category-button" data-category="キク科">キク科</button>
  <button class="category-button" data-category="マメ科">マメ科</button>
  <button class="category-button" data-category="その他">その他</button>
</div>

<!-- ゲーム開始ボタン -->
<button id="startButton">ゲーム開始</button>

<!-- 結果表示欄 -->
<div id="resultText" style="display:none; font-size:1.5em; margin-top:20px;"></div>

<!-- コンティニューボタン -->
<button id="continueButton">コンティニュー</button>

<!-- 全問題終了時の結果表示欄 -->
<div id="finalResult"></div>

<script>
  // ------ 設定部分（要カスタマイズ） ------ //
  // 画像ファイルが入ったフォルダパス
  const IMAGE_FOLDER = "植物/";

  // ファイル名(拡張子抜き) -> { flowerName: "○○", category: "××科 or その他" }
  // 実際には、一覧表すべてをここに入れてください。
  const plantData = {
    "アブラナ-アブラナ": {
      flowerName: "アブラナ",
      category: "アブラナ科"
    },
    "アブラナ-イヌガラシ": {
      flowerName: "イヌガラシ",
      category: "アブラナ科"
    },
    // ... (イネ-イネ, キク-キク, etc. のように全データを追記) ...
    // 例:
    // "イネ-イネ": {
    //   flowerName: "イネ",
    //   category: "イネ科"
    // },
    // "その他-アサガオ": {
    //   flowerName: "アサガオ",
    //   category: "その他"
    // }
  };

  // 上記のキー一覧を配列化
  const plantImages = Object.keys(plantData);

  // 出題数設定（全件出したい場合は plantImages.length などにする）
  let totalQuestions = 5;
  let currentQuestion = 0;  // 今何問目か
  let correctCount = 0;     // 正解数
  let usedImages = [];      // 出題済みの画像を記録

  // タイマー用
  let timeLeft = 60;
  let timerId = null;

  // 要素取得
  const plantImageElement = document.getElementById("plantImage");
  const resultCharacter = document.getElementById("resultCharacter");
  const timerElement = document.getElementById("timer");
  const startButton = document.getElementById("startButton");
  const categoryButtons = document.querySelectorAll(".category-button");
  const resultText = document.getElementById("resultText");
  const continueButton = document.getElementById("continueButton");
  const finalResult = document.getElementById("finalResult");

  // 初期状態
  plantImageElement.style.display = "none";
  categoryButtons.forEach(btn => btn.style.display = "none");

  // ▼ ゲーム開始ボタン
  startButton.addEventListener("click", () => {
    // 初期化
    currentQuestion = 0;
    correctCount = 0;
    usedImages = [];
    finalResult.style.display = "none";
    startButton.style.display = "none";

    // 最初の問題へ
    goNextQuestion();
  });

  // ▼ 次の問題へ進む
  function goNextQuestion() {
    currentQuestion++;
    if (currentQuestion <= totalQuestions) {
      showQuestion();
    } else {
      // 全部終わったら結果表示
      showFinalResult();
    }
  }

  // 1問を表示
  let randomKey = ""; // 出題したキーを一時保管
  function showQuestion() {
    // タイマーリセット
    timeLeft = 60;
    timerElement.textContent = timeLeft;
    timerId = setInterval(countdown, 1000);

    // まだ出題されていない画像をランダムに選ぶ
    do {
      const randomIndex = Math.floor(Math.random() * plantImages.length);
      randomKey = plantImages[randomIndex];
    } while (usedImages.includes(randomKey));

    // 出題済みに登録
    usedImages.push(randomKey);

    // 画像を表示
    plantImageElement.src = IMAGE_FOLDER + randomKey + ".png";
    plantImageElement.style.display = "block";

    // 分類ボタンを表示 & 動作割り当て
    categoryButtons.forEach(btn => {
      btn.style.display = "inline-block";
      btn.onclick = () => {
        const chosenCategory = btn.getAttribute("data-category");
        // 正解判定
        if (chosenCategory === plantData[randomKey].category) {
          correctCount++;
        }
        endQuestion();
      };
    });

    // 表示系をリセット
    resultCharacter.style.display = "none";
    resultText.style.display = "none";
    continueButton.style.display = "none";
    continueButton.style.bottom = "-60px";
  }

  // カウントダウン
  function countdown() {
    timeLeft--;
    timerElement.textContent = timeLeft;
    if (timeLeft <= 0) {
      // 時間切れ
      endQuestion();
    }
  }

  // 1問終了処理
  function endQuestion() {
    // タイマー停止
    clearInterval(timerId);

    // 問題表示を隠す
    plantImageElement.style.display = "none";
    categoryButtons.forEach(btn => btn.style.display = "none");

    // 結果発表キャラ & テキスト表示
    resultCharacter.style.display = "block";
    resultText.textContent =
      `正解数: ${correctCount} / ${currentQuestion}　
       この植物は: ${plantData[randomKey].flowerName}`;
    resultText.style.display = "block";

    // コンティニューボタンを表示
    continueButton.style.display = "block";
    setTimeout(() => {
      continueButton.style.bottom = "50%";
    }, 100);
  }

  // コンティニューボタン → 次の問題
  continueButton.addEventListener("click", () => {
    continueButton.style.bottom = "-60px";
    continueButton.style.display = "none";
    goNextQuestion();
  });

  // 全問題終了後
  function showFinalResult() {
    resultCharacter.style.display = "block";
    finalResult.innerHTML = `ゲーム終了！<br>
      全${totalQuestions}問中 ${correctCount}問 正解でした！`;
    finalResult.style.display = "block";
    // もう一度遊べるように開始ボタン再表示
    startButton.style.display = "inline-block";
  }
</script>
</body>
</html>
